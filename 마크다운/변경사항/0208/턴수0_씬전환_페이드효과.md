# 턴수 0 시 Night 씬 전환 (페이드 효과 포함)

## 작업일: 2026-02-08

---

## 1. 개요

턴 수가 모두 차감되어 0이 되면, 페이드 아웃 → Night 씬 로드 → 페이드 인 효과와 함께 씬이 자동으로 전환되도록 구현했습니다.

---

## 2. 생성된 파일

### 2.1 `Assets/Scenes/Ryu/Night.unity/Night.unity` (신규)

**역할**: 턴수가 0이 되면 전환되는 새 씬

**내용**: 기본 씬 (Main Camera, Directional Light 포함)

---

### 2.2 `Assets/Scripts/Ryu/Tutorial/SceneFadeManager.cs` (신규)

**역할**: 씬 전환 시 페이드 인/아웃 효과 담당

**주요 기능**:
- `LoadSceneWithFade()`: 페이드 아웃 → 씬 로드 → 페이드 인을 순차적으로 실행
- `FadeOut()`: 투명 → 검은색으로 전환 (페이드 아웃)
- `FadeIn()`: 검은색 → 투명으로 전환 (페이드 인)
- 코루틴을 사용하여 부드러운 페이드 애니메이션 구현

**필수 컴포넌트**:
- Canvas에 검은색 Image 오브젝트 필요 (페이드 효과용)

**Inspector 설정 항목**:
| 항목 | 타입 | 기본값 | 설명 |
|------|------|--------|------|
| fadeImage | Image | (비어있음) | 페이드 효과용 검은색 Image 참조 |
| defaultFadeDuration | float | 1f | 기본 페이드 시간 (초) |

**주요 메서드**:
```csharp
public void LoadSceneWithFade(string sceneName, float fadeDuration)
private IEnumerator FadeOut(float duration)  // 페이드 아웃
private IEnumerator FadeIn(float duration)    // 페이드 인
```

**동작 원리**:
- `fadeImage`의 Color.alpha 값을 코루틴으로 조절
- 페이드 아웃: alpha 0 → 1 (투명 → 불투명)
- 페이드 인: alpha 1 → 0 (불투명 → 투명)

---

## 3. 수정된 파일

### `Assets/Scripts/Ryu/Tutorial/TurnManager.cs` (수정)

#### 3.1 추가된 필드

```csharp
[Header("Scene Transition")]
[SerializeField] private SceneFadeManager fadeManager;
[SerializeField] private string nightSceneName = "Night";
[SerializeField] private float fadeDuration = 1f;
```

#### 3.2 수정된 메서드

**`ConsumeTurn()`**
- 턴수 차감 후 `remainingTurns == 0` 체크
- 0이면 `fadeManager.LoadSceneWithFade()` 호출
- `fadeManager`가 연결되지 않은 경우 경고 로그 후 페이드 없이 씬 전환

```csharp
if (remainingTurns == 0)
{
    Debug.Log("[TurnManager] 턴수가 0이 되었습니다. Night 씬으로 전환합니다.");
    if (fadeManager != null)
    {
        fadeManager.LoadSceneWithFade(nightSceneName, fadeDuration);
    }
    else
    {
        Debug.LogWarning("[TurnManager] SceneFadeManager가 연결되지 않았습니다. 페이드 없이 씬을 전환합니다.");
        UnityEngine.SceneManagement.SceneManager.LoadScene(nightSceneName);
    }
}
```

---

## 4. 씬 변경사항 (Tutorial.unity)

### 4.1 컴포넌트 추가 필요

| GameObject | 추가할 컴포넌트 |
|------------|----------------|
| GameManager | SceneFadeManager |

### 4.2 Inspector 참조 연결 필요

**GameManager의 SceneFadeManager 컴포넌트**:
- `Fade Image` → `Canvas/FadePanel`의 Image 컴포넌트

**GameManager의 TurnManager 컴포넌트**:
- `Fade Manager` → GameManager의 SceneFadeManager 컴포넌트
- `Night Scene Name` → "Night" (기본값)
- `Fade Duration` → 1 (기본값, 초 단위)

---

## 5. Unity Editor에서 수동 설정 필요

### 5.1 Canvas에 페이드용 Image 오브젝트 생성

1. Hierarchy에서 `Canvas` 선택
2. 우클릭 → UI → Image 선택
3. 이름을 `FadePanel`로 변경
4. `FadePanel` 설정:
   - **RectTransform**:
     - Anchor Preset: "Stretch-Stretch" 선택
     - Left/Right/Top/Bottom: 모두 0
   - **Image 컴포넌트**:
     - Color: 검은색 (R:0, G:0, B:0, A:0) - 초기값은 투명
     - Raycast Target: **체크 해제** (클릭 이벤트 차단 방지)

### 5.2 GameManager에 컴포넌트 추가

1. `GameManager` 선택
2. Add Component → `SceneFadeManager` 추가
3. Inspector에서 참조 연결:
   - `Fade Image` → `Canvas/FadePanel`의 Image 컴포넌트

### 5.3 TurnManager 참조 연결

1. `GameManager`의 `TurnManager` 컴포넌트 선택
2. Inspector에서:
   - `Fade Manager` → GameManager의 SceneFadeManager 컴포넌트 드래그

### 5.4 Night 씬을 Build Settings에 추가

1. File → Build Settings 열기
2. Scenes In Build에 `Assets/Scenes/Ryu/Night.unity/Night.unity` 추가
3. 또는 Project 창에서 Night.unity를 드래그하여 추가

---

## 6. 동작 흐름

```
[API 응답 수신]
  ↓
InputHandler.OnApiSuccess()
  ↓
TurnManager.ConsumeTurn()
  ↓
remainingTurns-- (1 차감)
  ↓
UpdateTurnsDisplay()
  ↓
[remainingTurns == 0 체크]
  ↓
SceneFadeManager.LoadSceneWithFade("Night", 1f)
  ↓
[페이드 아웃 시작 - 1초 동안 검은색으로 전환]
  ↓
SceneManager.LoadScene("Night")
  ↓
[Night 씬 로드]
  ↓
[페이드 인 시작 - 1초 동안 투명하게 전환]
  ↓
[완료]
```

---

## 7. 페이드 효과 상세

### 7.1 페이드 아웃 (FadeOut)

- **시작**: 투명 (alpha = 0)
- **종료**: 불투명 (alpha = 1, 검은색)
- **시간**: `fadeDuration` (기본 1초)
- **사용 시점**: 씬 전환 직전

### 7.2 페이드 인 (FadeIn)

- **시작**: 불투명 (alpha = 1, 검은색)
- **종료**: 투명 (alpha = 0)
- **시간**: `fadeDuration` (기본 1초)
- **사용 시점**: 새 씬 로드 직후

### 7.3 구현 방식

- 코루틴을 사용하여 매 프레임 alpha 값을 조절
- `Time.deltaTime`을 사용하여 프레임레이트와 무관하게 일정한 속도로 페이드
- `Mathf.Clamp01()`로 alpha 값을 0~1 범위로 제한

---

## 8. 디버그 로그

| 태그 | 내용 |
|------|------|
| `[TurnManager]` | `턴수가 0이 되었습니다. Night 씬으로 전환합니다.` |
| `[TurnManager]` | `SceneFadeManager가 연결되지 않았습니다. 페이드 없이 씬을 전환합니다.` (경고) |
| `[SceneFadeManager]` | `페이드 아웃 시작 → {sceneName} 씬으로 전환` |
| `[SceneFadeManager]` | `{sceneName} 씬 로드 중...` |
| `[SceneFadeManager]` | `페이드 인 완료` |

---

## 9. 파일 구조

```
Assets/
├── Scenes/
│   └── Ryu/
│       ├── Tutorial.unity
│       └── Night.unity/          ← 새 씬 (신규)
│           └── Night.unity
└── Scripts/
    └── Ryu/
        └── Tutorial/
            ├── TurnManager.cs          ← 씬 전환 로직 추가
            └── SceneFadeManager.cs      ← 페이드 효과 (신규)
```

---

## 10. 주의사항

1. **페이드 UI 설정**: `FadePanel`의 Raycast Target을 반드시 해제해야 클릭 이벤트가 차단되지 않습니다.
2. **Build Settings**: Night 씬을 Build Settings에 추가하지 않으면 씬 전환 시 에러가 발생합니다.
3. **씬 이름**: `nightSceneName`은 Build Settings에 등록된 씬 이름과 정확히 일치해야 합니다.
4. **페이드 Image**: `fadeImage`가 연결되지 않으면 페이드 효과가 작동하지 않습니다. 이 경우 경고 로그가 출력되고 페이드 없이 씬이 전환됩니다.


