# 혼돈의 밤 엔딩 — 단계 요약

**전제:** 이 문서는 혼돈의 밤 엔딩에 이르는 **주요 단계**만 정리한다. 요청/응답 JSON 구조·필드 의미·NPC·아이템 매핑은 상위 문서를 참조할 것.

---

## 흐름 개요

| 단계       | 내용                                                                                                                                           |
| ---------- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| **조건 1** | 안방에서 라이터 습득 → 지하실에서 기름병 습득                                                                                                  |
| **조건 2** | 할머니에게 말 걸기 → 생기를 나누어 주기 → 할머니가 새엄마 불 취약·기름+라이터 탈출법 전달 → 새엄마에게 기름병 던지고 라이터로 불 붙이기 → 엔딩 |

---

## 조건 1 — 아이템 습득

1. **안방에서 라이터 습득**
   - 안방에서 라이터(`silver_lighter`)를 획득. `inventory_add`로 반환.

   **예시 프론트 입력**

   ```json
   {
     "chat_input": "안방에서 라이터를 집어 든다.",
     "npc_name": "",
     "item_name": ""
   }
   ```

   **예시 백엔드 응답**

   ```json
   {
     "narrative": "안방 바닥에 은빛 라이터가 놓여 있다. 조용히 손에 넣었다.",
     "ending_info": null,
     "state_result": { "inventory_add": ["silver_lighter"] }
   }
   ```

2. **지하실에서 기름병 습득**
   - 지하실에서 기름병(`oil_bottle`)을 획득. `inventory_add`로 반환.

   **예시 프론트 입력**

   ```json
   {
     "chat_input": "지하실에서 기름병을 찾아 든다.",
     "npc_name": "",
     "item_name": ""
   }
   ```

   **예시 백엔드 응답**

   ```json
   {
     "narrative": "지하실 한구석에 기름이 담긴 병이 있다. 무겁고 냄새가 진하다.",
     "ending_info": null,
     "state_result": { "inventory_add": ["oil_bottle"] }
   }
   ```

---

## 조건 2 — 할머니에게서 탈출 정보 습득 후 엔딩

1. **할머니에게 말 걸기**
   - 할머니(`grandmother`)에게 말을 걸면, 생기를 나누어 달라고 요구하는 나레이션.

   **예시 프론트 입력**

   ```json
   {
     "chat_input": "할머니에게 다가가 말을 건다.",
     "npc_name": "grandmother",
     "item_name": ""
   }
   ```

   **예시 백엔드 응답**

   ```json
   {
     "narrative": "할머니가 흐릿한 눈으로 나를 본다. '이 아이야... 나에게 생기를 조금만 나누어 주겠니? 그리하면 네가 궁금해하는 것을 말해 줄 수 있어.'",
     "ending_info": null,
     "state_result": {}
   }
   ```

2. **생기를 나누어 주기**
   - 생기를 나누어 주면 할머니가 새엄마가 불에 취약하다는 점, 기름병을 던지고 라이터로 불을 붙이면 새엄마가 죽고 꿈속 세계에서 벗어날 수 있다고 **나레이션**으로 전달.

   **예시 프론트 입력**

   ```json
   {
     "chat_input": "할머니에게 생기를 나누어 준다.",
     "npc_name": "grandmother",
     "item_name": ""
   }
   ```

   **예시 백엔드 응답**

   ```json
   {
     "narrative": "할머니에게 손을 내밀자, 차가운 손이 내 손을 잡는다. 잠시 후 할머니가 작은 목소리로 속삭인다. '그 여자... 불에 약해. 기름을 그녀에게 뿌리고, 라이터로 불을 붙여. 그러면 그녀는 사라지고, 너는 이 꿈에서 깨어날 수 있어.'",
     "ending_info": null,
     "state_result": {
       "humanity": 85.0
     }
   }
   ```

   - **참고:** 생기 나누기로 인간성(`humanity`)이 소폭 감소할 수 있음. 변경 없으면 `state_result` 생략 가능.

3. **새엄마에게 기름병 던지고 라이터로 불 붙이기 → 엔딩**
   - 조건: 기름병·라이터 보유, 할머니에게서 탈출 정보 습득 후.
   - 새엄마에게 기름병을 던지고 라이터로 불을 붙이면 **엔딩 트리거**.
   - 응답에 **`ending_info`**: `ending_id: "chaotic_breakout"`, `name`, `epilogue_prompt` 설정.
   - `inventory_remove`: 기름병, 라이터.

   **예시 프론트 입력**

   ```json
   {
     "chat_input": "새엄마에게 기름병을 던지고 라이터로 불을 붙인다.",
     "npc_name": "stepmother",
     "item_name": ["oil_bottle", "silver_lighter"]
   }
   ```

   - `item_name`: 사용 아이템(기름병 `oil_bottle`, 라이터 `silver_lighter`) 모두 전달. 상호작용 대상 NPC는 `npc_name`으로 전달.

   **예시 백엔드 응답**

   ```json
   {
     "narrative": "기름병이 새엄마에게 부딪혀 깨진다. 번쩍— 라이터를 켜 손을 뻗는 순간, 불꽃이 퍼져 나간다. 새엄마의 비명과 함께 세계가 흔들리기 시작한다.",
     "ending_info": {
       "ending_id": "chaotic_breakout",
       "name": "혼돈의 밤 (Chaotic Breakout)",
       "epilogue_prompt": "불길 속에서 꿈의 세계가 무너지고, 마침내 눈을 뜬다."
     },
     "state_result": {
       "inventory_remove": ["oil_bottle", "silver_lighter"]
     }
   }
   ```

---

## 참고 ID (요약)

- **NPC:** `grandmother` → `NPCType.Grandmother`, `stepmother`/`new_mother` → `NPCType.NewMother` (BackendResponseSpec.md NPC 매핑 참조).
- **아이템:** `silver_lighter`(라이터), `oil_bottle`(기름병).
- **엔딩:** `chaotic_breakout` → `EndingType.ChaoticBreakout`.
