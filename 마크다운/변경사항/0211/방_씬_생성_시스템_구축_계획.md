# 방 씬 생성 시스템 구축 계획

## 개요

Tutorial 씬의 구조를 분석하여 공통 Prefab 시스템을 구축하고, 시나리오에 명시된 7개 방(주인공의 방, 복도, 거실, 주방, 동생의 놀이방, 지하실, 뒷마당)을 효율적으로 생성할 수 있는 표준화된 구조를 만듭니다.

## 결정된 아키텍처

### 1. 씬 구조 및 매니저 관리

- **방식**: 공통 매니저 Prefab 생성 → 모든 씬에 배치
- **구현**: `Assets/Assets/Prefabs/Managers/` 폴더에 공통 Prefab 생성

### 2. TurnManager 관리

- **방식**: 모든 방에서 동일한 TurnManager 사용
- **구현**: `TutorialTurnManager`를 일반화하여 `RoomTurnManager`로 리팩토링

### 3. Canvas 및 UI 구조

- **방식**: 공통 Canvas Prefab 생성 → 모든 씬에 배치
- **구현**: `Assets/Assets/Prefabs/UI/` 폴더에 Canvas Prefab 생성 (기존 `Assets/Assets/UI/` 폴더는 이미지 리소스용)

### 4. 상호작용 오브젝트

- **방식**: 공통 상호작용 오브젝트 Prefab 생성 (ClickableObject + HoverGlow 조합)
- **구현**: `Assets/Assets/Prefabs/Interactables/` 폴더에 기본 Prefab 생성

### 5. 씬 전환 및 페이드

- **방식**: 공통 SceneFadeManager Prefab 생성 → 모든 씬에 배치
- **구현**: `Assets/Assets/Prefabs/Managers/` 폴더에 포함

### 6. 카메라 및 EventSystem

- **방식**: 공통 Camera + EventSystem Prefab 생성 → 모든 씬에 배치
- **구현**: `Assets/Assets/Prefabs/Camera/` 폴더에 Prefab 생성

### 7. GameStateManager 및 ApiClient

- **방식**: 각 씬마다 배치 (싱글톤이므로 중복 생성 방지)
- **구현**: `Assets/Assets/Prefabs/Managers/` 폴더에 Prefab 생성

### 8. NPC 관리

- **방식**: NPC Prefab 생성 → 씬별로 필요한 NPC만 배치
- **구현**: `Assets/Assets/Prefabs/NPCs/` 폴더에 각 NPC Prefab 생성 (기존 Character 폴더는 이미지 리소스용)

### 9. 아이템 관리

- **방식**: NPC와 동일하게 아이템 Prefab 생성 → 씬별로 필요한 아이템만 배치
- **구현**: `Assets/Assets/Prefabs/Items/` 폴더에 각 아이템 Prefab 생성 (기존 Object 폴더는 이미지 리소스용)

### 10. 배경 관리

- **방식**: 각 방 씬마다 독립적인 Background GameObject 배치
- **구현**: 씬별로 직접 배치 (Prefab 불필요)

## 작업 단계

### Phase 1: 폴더 구조 생성

1. **Prefab 폴더 구조 생성**

- `Assets/Assets/Prefabs/Managers/` - 공통 매니저 Prefab
- `Assets/Assets/Prefabs/UI/` - UI Prefab (기존 `Assets/Assets/UI/` 폴더는 이미지 리소스용)
- `Assets/Assets/Prefabs/Camera/` - 카메라 및 EventSystem Prefab
- `Assets/Assets/Prefabs/Interactables/` - 상호작용 오브젝트 Prefab
- `Assets/Assets/Prefabs/NPCs/` - NPC Prefab (기존 `Assets/Assets/Character/` 폴더는 이미지 리소스용)
- `Assets/Assets/Prefabs/Items/` - 아이템 Prefab (기존 `Assets/Assets/Object/` 폴더는 이미지 리소스용)

### Phase 2: TurnManager 일반화

2. **TutorialTurnManager 리팩토링**

- 파일: `Assets/Scripts/Ryu/Tutorial/TurnManager.cs`
- 클래스명 변경: `TutorialTurnManager` → `RoomTurnManager`
- 씬 이름 하드코딩 제거: `tutorialSceneName` 필드를 제거하고 현재 씬 이름을 동적으로 사용하거나 Inspector에서 설정 가능하게 변경
- 파일 이동: `Assets/Scripts/Ryu/Global/Managers/RoomTurnManager.cs`로 이동
- `StartNewDay()` 메서드 수정: 현재 씬 이름을 유지하도록 변경

3. **InputHandler 수정**

- 파일: `Assets/Scripts/Ryu/Tutorial/InputHandler.cs`
- `TutorialTurnManager` 참조를 `RoomTurnManager`로 변경

4. **ApiResponseHandler 수정**

- 파일: `Assets/Scripts/Ryu/Global/API/ApiResponseHandler.cs`
- `TutorialTurnManager` 참조를 `RoomTurnManager`로 변경

### Phase 3: 공통 Prefab 생성

5. **GameManager Prefab 생성**

- Tutorial 씬의 GameManager GameObject를 Prefab으로 저장
- 경로: `Assets/Assets/Prefabs/Managers/GameManager.prefab`
- 컴포넌트:
    - `InputHandler` (TutorialTurnManager → RoomTurnManager 참조로 수정)
    - `RoomTurnManager` (기존 TutorialTurnManager 대체)
    - `SceneFadeManager`

6. **Canvas Prefab 생성**

- Tutorial 씬의 Canvas GameObject를 Prefab으로 저장
- 경로: `Assets/Assets/Prefabs/UI/GameCanvas.prefab`
- 포함 요소:
    - InputField (TMP)
    - ResultText (TMP)
    - TurnsText (TMP)
    - HumanityText (TMP)
    - FadeImage (Image)
    - 기타 UI 요소

7. **Camera + EventSystem Prefab 생성**

- Tutorial 씬의 Main Camera와 EventSystem을 하나의 Prefab으로 통합
- 경로: `Assets/Assets/Prefabs/Camera/MainCameraWithEventSystem.prefab`
- 구조:
    - Main Camera (Transform, Camera, AudioListener, UniversalAdditionalCameraData, Physics2DRaycaster)
    - EventSystem (Transform, EventSystem, InputSystemUIInputModule)

8. **SceneFadeManager Prefab 생성**

- GameManager Prefab에 포함되므로 별도 생성 불필요
- 또는 독립적으로 사용할 경우 `Assets/Assets/Prefabs/Managers/SceneFadeManager.prefab` 생성

9. **GameStateManager Prefab 생성**

- Tutorial 씬의 GameStateManager GameObject를 Prefab으로 저장
- 경로: `Assets/Assets/Prefabs/Managers/GameStateManager.prefab`
- 싱글톤이므로 각 씬에 배치해도 중복 생성되지 않음

10. **ApiClient Prefab 생성**

    - Tutorial 씬의 ApiClient GameObject를 Prefab으로 저장 (또는 GameManager에 포함)
    - 경로: `Assets/Assets/Prefabs/Managers/ApiClient.prefab`
    - 또는 GameManager Prefab에 포함

### Phase 4: 상호작용 오브젝트 Prefab 생성

11. **기본 상호작용 오브젝트 Prefab 생성**

    - 경로: `Assets/Assets/Prefabs/Interactables/InteractableObject.prefab`
    - 컴포넌트:
    - `Transform`
    - `SpriteRenderer`
    - `BoxCollider2D`
    - `HoverGlow`
    - `ClickableObject`
    - 스프라이트는 비워두고 씬별로 설정

### Phase 5: NPC Prefab 생성

12. **NPC Prefab 생성 (각 NPC별로)**

    - 경로: `Assets/Assets/Prefabs/NPCs/`
    - 파일명:
    - `NPC_NewMother.prefab` (새엄마)
    - `NPC_NewFather.prefab` (새아빠)
    - `NPC_Sibling.prefab` (동생)
    - `NPC_Dog.prefab` (강아지)
    - `NPC_Grandmother.prefab` (할머니)
    - 기본 컴포넌트:
    - `Transform`
    - `SpriteRenderer`
    - `BoxCollider2D`
    - `HoverGlow`
    - `ClickableObject`
    - NPC별 특수 컴포넌트는 추후 추가

### Phase 6: 아이템 Prefab 생성

13. **아이템 Prefab 생성 (각 아이템별로)**

    - 경로: `Assets/Assets/Prefabs/Items/`
    - 파일명:
    - `Item_SleepingPill.prefab` (수면제)
    - `Item_EarlGreyTea.prefab` (홍차)
    - `Item_RealFamilyPhoto.prefab` (진짜 가족 사진)
    - `Item_OilBottle.prefab` (기름병)
    - `Item_SilverLighter.prefab` (라이터)
    - `Item_SiblingsToy.prefab` (동생의 장난감)
    - `Item_BrassKey.prefab` (황동 열쇠)
    - 기본 컴포넌트:
    - `Transform`
    - `SpriteRenderer`
    - `BoxCollider2D`
    - `HoverGlow`
    - `ClickableObject`
    - 아이템별 스프라이트는 추후 설정

### Phase 7: Tutorial 씬 업데이트

14. **Tutorial 씬을 새 Prefab 시스템으로 전환**

    - 기존 GameObject들을 Prefab 인스턴스로 교체
    - GameManager → `Assets/Assets/Prefabs/Managers/GameManager.prefab` 인스턴스
    - Canvas → `Assets/Assets/Prefabs/UI/GameCanvas.prefab` 인스턴스
    - Main Camera + EventSystem → `Assets/Assets/Prefabs/Camera/MainCameraWithEventSystem.prefab` 인스턴스
    - GameStateManager → `Assets/Assets/Prefabs/Managers/GameStateManager.prefab` 인스턴스
    - StepMother → `Assets/Assets/Prefabs/NPCs/NPC_NewMother.prefab` 인스턴스
    - Cake → `Assets/Assets/Prefabs/Items/Item_Cake.prefab` 인스턴스 (또는 상호작용 오브젝트 Prefab 사용)

### Phase 8: 새 방 씬 생성 가이드 문서화

15. **새 방 씬 생성 가이드 작성**

    - 마크다운 문서 생성: `마크다운/개발/방_씬_생성_가이드.md`
    - 포함 내용:
    - Prefab 배치 순서
    - 씬별 필수 요소 체크리스트
    - NPC 및 아이템 배치 방법
    - 배경 이미지 설정 방법
    - 씬 이름 및 GameLocation enum 매핑

## 파일 구조

```
Assets/
├── Assets/
│   ├── Background/          (기존: 배경 이미지 리소스)
│   ├── Character/           (기존: 캐릭터 이미지 리소스)
│   ├── Object/              (기존: 오브젝트 이미지 리소스)
│   ├── UI/                  (기존: UI 이미지 리소스)
│   └── Prefabs/             (신규: Prefab 폴더)
│       ├── Managers/
│       │   ├── GameManager.prefab
│       │   ├── GameStateManager.prefab
│       │   └── ApiClient.prefab
│       ├── UI/
│       │   └── GameCanvas.prefab
│       ├── Camera/
│       │   └── MainCameraWithEventSystem.prefab
│       ├── Interactables/
│       │   └── InteractableObject.prefab
│       ├── NPCs/
│       │   ├── NPC_NewMother.prefab
│       │   ├── NPC_NewFather.prefab
│       │   ├── NPC_Sibling.prefab
│       │   ├── NPC_Dog.prefab
│       │   └── NPC_Grandmother.prefab
│       └── Items/
│           ├── Item_SleepingPill.prefab
│           ├── Item_EarlGreyTea.prefab
│           ├── Item_RealFamilyPhoto.prefab
│           ├── Item_OilBottle.prefab
│           ├── Item_SilverLighter.prefab
│           ├── Item_SiblingsToy.prefab
│           └── Item_BrassKey.prefab
└── Scripts/
    └── Ryu/
        ├── Tutorial/
        │   └── TurnManager.cs (삭제 또는 RoomTurnManager로 변경)
        └── Global/
            └── Managers/
                └── RoomTurnManager.cs (신규)
```

## 주의사항

1. **싱글톤 관리**: GameStateManager와 ApiClient는 싱글톤이므로 각 씬에 배치해도 중복 생성되지 않지만, 첫 번째 로드된 씬의 인스턴스가 유지됩니다.

2. **씬 이름 매핑**: RoomTurnManager의 `StartNewDay()` 메서드에서 씬 전환 시 현재 씬 이름을 유지하도록 수정해야 합니다.

3. **NPC/아이템 상태 동기화**: NPC와 아이템의 상태(위치, 호감도, 획득 여부 등)는 GameStateManager에서 관리하므로, 씬 로드 시 상태를 동기화하는 로직이 필요할 수 있습니다.

4. **배경 이미지**: 각 방의 배경은 씬별로 독립적으로 배치하므로 Prefab으로 만들지 않습니다.

## 다음 단계 (구현 후)

- 새 방 씬 생성 (주인공의 방, 복도, 거실, 주방, 동생의 놀이방, 지하실, 뒷마당)
- NPC 상태 동기화 시스템 구현
- 아이템 상태 동기화 시스템 구현

