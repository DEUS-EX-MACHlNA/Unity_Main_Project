# 엔딩 씬 생성 가이드

## 개요

본 가이드는 TC-04 테스트를 완료하기 위해 필요한 엔딩 씬들을 생성하는 방법을 설명합니다.

**작성일**: 2025-02-11  
**프로젝트**: My project (3)  
**Unity 버전**: 6000.3.5f2

---

## 필요한 엔딩 씬 목록

`EndingManager.GetEndingSceneName()` 메서드에 따르면 다음 엔딩 씬들이 필요합니다:

| EndingType | 씬 이름 | 파일 경로 | 상태 |
|------------|---------|-----------|------|
| StealthExit | `Ending_StealthExit` | `Assets/Scenes/Ryu/Ending_StealthExit.unity` | ❌ 미생성 |
| ChaoticBreakout | `Ending_ChaoticBreakout` | `Assets/Scenes/Ryu/Ending_ChaoticBreakout.unity` | ❌ 미생성 |
| SiblingsHelp | `Ending_SiblingsHelp` | `Assets/Scenes/Ryu/Ending_SiblingsHelp.unity` | ❌ 미생성 |
| UnfinishedDoll | `GameOver` | `Assets/Scenes/Ryu/GameOver.unity` | ✅ 존재함 |
| EternalDinner | `Ending_EternalDinner` | `Assets/Scenes/Ryu/Ending_EternalDinner.unity` | ❌ 미생성 |

**⚠️ 중요**: 씬 이름은 **정확히** 위와 같아야 합니다. 대소문자도 일치해야 합니다.

---

## 씬 생성 절차

### 1단계: 새 씬 생성

각 엔딩 씬을 Unity Editor에서 생성합니다:

1. **Unity Editor에서 씬 생성**
   - `File > New Scene` 또는 `Ctrl+N`
   - `Basic (Built-in)` 템플릿 선택 (또는 프로젝트에 맞는 템플릿)
   - `Create` 클릭

2. **씬 저장**
   - `File > Save As` 또는 `Ctrl+Shift+S`
   - 저장 경로: `Assets/Scenes/Ryu/`
   - 파일명: `Ending_StealthExit.unity` (또는 다른 엔딩 이름)
   - **중요**: 파일명이 `EndingManager`가 기대하는 씬 이름과 정확히 일치해야 합니다.

3. **나머지 엔딩 씬도 동일하게 생성**
   - `Ending_ChaoticBreakout.unity`
   - `Ending_SiblingsHelp.unity`
   - `Ending_EternalDinner.unity`

---

### 2단계: 최소 씬 구조 구성

각 엔딩 씬에는 최소한 다음 요소가 필요합니다:

#### 필수 요소

1. **Main Camera**
   - 기본 씬에 포함되어 있음
   - 또는 기존 씬의 `MainCameraWithEventSystem` Prefab 사용 가능

2. **EventSystem** (UI 상호작용용)
   - 기본 씬에 포함되어 있지 않을 수 있음
   - `GameObject > UI > Event System`으로 생성
   - 또는 기존 씬의 `MainCameraWithEventSystem` Prefab 사용 가능

3. **SceneFadeManager** (페이드 효과용)
   - `EndingManager`가 `SceneFadeManager.LoadSceneWithFade()`를 호출하므로 필요
   - 기존 씬의 `GameManager` Prefab에 포함되어 있을 수 있음
   - 또는 독립적으로 배치

4. **배경/UI 요소**
   - 엔딩 텍스트 표시용 UI
   - 배경 이미지 또는 3D 환경

#### 선택적 요소

- **GameStateManager** (싱글톤이므로 배치 불필요, 기존 인스턴스 사용)
- **ApiClient** (엔딩 씬에서는 불필요)
- **InputHandler** (엔딩 씬에서는 불필요)

---

### 3단계: 씬 구조 예시

#### 최소 구조 (GameOver 씬 참고)

```
Ending_StealthExit (씬)
├── Main Camera
├── EventSystem
├── GameCanvas (Canvas)
│   ├── EndingText (TextMeshProUGUI) - 엔딩 텍스트 표시
│   ├── FadePanel (Image) - SceneFadeManager용 페이드 이미지
│   └── (선택) RestartButton (Button) - 재시작 버튼
└── GameManager (GameObject)
    └── SceneFadeManager (Component)
```

#### GameOver 씬 구조 참고

`GameOver` 씬은 이미 존재하므로 이를 참고하여 엔딩 씬을 만들 수 있습니다:

- **GameOverManager** 스크립트가 있음 (`Assets/Scripts/Ryu/GameOver/GameOverManager.cs`)
- 재시작 기능 제공
- `SceneFadeManager` 사용

**참고**: 엔딩 씬은 `GameOverManager`와 유사한 구조로 만들되, 각 엔딩에 맞는 텍스트와 UI를 배치하면 됩니다.

---

### 4단계: SceneFadeManager 설정

각 엔딩 씬에 `SceneFadeManager`가 필요합니다:

1. **GameManager GameObject 생성**
   - `GameObject > Create Empty`
   - 이름: `GameManager`

2. **SceneFadeManager 컴포넌트 추가**
   - `GameManager` 선택
   - `Add Component > SceneFadeManager`

3. **FadePanel 설정**
   - Canvas에 `FadePanel` Image 생성 (없을 경우)
   - `GameObject > UI > Image`
   - 이름: `FadePanel`
   - 색상: 검은색 (R: 0, G: 0, B: 0, A: 0 - 초기 투명)
   - RectTransform을 전체 화면으로 설정 (Anchor: Stretch-Stretch)

4. **SceneFadeManager에 FadePanel 연결**
   - `GameManager`의 `SceneFadeManager` 컴포넌트 선택
   - `Fade Image` 필드에 `FadePanel` Image 드래그 앤 드롭

**또는**: 기존 씬의 `GameManager` Prefab을 사용할 수 있다면 더 효율적입니다.

---

### 5단계: Build Settings에 씬 등록

**⚠️ 필수**: 씬을 생성한 후 반드시 Build Settings에 등록해야 합니다. 등록하지 않으면 `SceneFadeManager`가 씬을 로드할 수 없습니다.

1. **Build Settings 열기**
   - `File > Build Settings` 또는 `Ctrl+Shift+B`

2. **씬 추가**
   - `Add Open Scenes` 버튼 클릭 (현재 열려있는 씬 추가)
   - 또는 씬 파일을 드래그 앤 드롭

3. **등록 확인**
   - 다음 씬들이 Build Settings에 등록되어 있는지 확인:
     - `Ending_StealthExit`
     - `Ending_ChaoticBreakout`
     - `Ending_SiblingsHelp`
     - `Ending_EternalDinner`

4. **씬 순서 (선택)**
   - Build Index는 자동으로 할당되므로 순서는 중요하지 않습니다.
   - 다만, 씬이 `enabled` 상태여야 합니다 (체크박스가 체크되어 있어야 함).

---

## 각 엔딩별 특수 요구사항

### Ending_StealthExit (완벽한 기만)

- **엔딩 설명**: "완벽한 기만 - 당신은 아무도 눈치채지 못하게 탈출했습니다."
- **UI 요소**: 탈출 성공 메시지, 배경 이미지
- **추가 기능**: (선택) 재시작 버튼

### Ending_ChaoticBreakout (혼란스러운 탈출)

- **엔딩 설명**: 혼란스러운 탈출 엔딩
- **UI 요소**: 탈출 메시지, 배경 이미지
- **추가 기능**: (선택) 재시작 버튼

### Ending_SiblingsHelp (동생의 도움)

- **엔딩 설명**: 동생의 도움으로 탈출
- **UI 요소**: 동생과의 협력 메시지, 배경 이미지
- **추가 기능**: (선택) 재시작 버튼

### Ending_EternalDinner (영원한 식사 시간)

- **엔딩 설명**: 5일차 종료 시 처리되는 엔딩
- **UI 요소**: 영원한 식사 시간 메시지, 배경 이미지
- **추가 기능**: (선택) 재시작 버튼

### GameOver (불완전한 박제)

- **상태**: ✅ 이미 존재함
- **엔딩 설명**: 인간성이 0%에 도달한 배드 엔딩
- **특징**: `GameOverManager` 스크립트가 이미 구현되어 있음
- **참고**: 다른 엔딩 씬도 `GameOverManager`와 유사한 구조로 만들 수 있음

---

## 빠른 생성 체크리스트

각 엔딩 씬마다 다음을 확인하세요:

- [ ] 씬 파일 생성 (`Ending_*.unity`)
- [ ] 씬 이름이 `EndingManager`가 기대하는 이름과 정확히 일치하는지 확인
- [ ] Main Camera 존재
- [ ] EventSystem 존재
- [ ] SceneFadeManager 설정 (GameManager + FadePanel)
- [ ] 엔딩 텍스트 표시용 UI 요소 배치
- [ ] Build Settings에 씬 등록
- [ ] Build Settings에서 씬이 `enabled` 상태인지 확인

---

## 씬 생성 후 테스트

### 1. 씬 로드 테스트

Unity Editor에서 직접 씬을 로드하여 확인:

1. `File > Open Scene`
2. `Assets/Scenes/Ryu/Ending_StealthExit.unity` 선택
3. Play 모드로 진입하여 씬이 정상적으로 표시되는지 확인

### 2. 씬 전환 테스트

코드에서 직접 씬 전환을 테스트:

```csharp
// Unity Editor Console에서 실행
SceneFadeManager fadeManager = FindFirstObjectByType<SceneFadeManager>();
if (fadeManager != null)
{
    fadeManager.LoadSceneWithFade("Ending_StealthExit", 1f);
}
```

### 3. 엔딩 트리거 테스트

실제 게임 플레이에서 엔딩을 트리거하여 씬 전환이 정상적으로 동작하는지 확인:

- TC-04 테스트 실행
- Unity Console에서 `[SceneFadeManager] 페이드 아웃 시작 → Ending_... 씬으로 전환` 로그 확인
- 에러 없이 씬이 전환되는지 확인

---

## 문제 해결

### 문제 1: 씬 로드 실패

**증상**: Unity Console에 다음 에러가 출력됨
```
[SceneFadeManager] 씬 로드 실패: 'Ending_StealthExit' (Build Profiles/Shared scene list에 씬이 등록되어 있어야 합니다)
```

**해결 방법**:
1. Build Settings에 씬이 등록되어 있는지 확인
2. 씬 이름이 정확히 일치하는지 확인 (대소문자 포함)
3. 씬 파일이 `Assets/Scenes/Ryu/` 폴더에 있는지 확인

### 문제 2: 페이드 효과가 동작하지 않음

**증상**: 씬 전환은 되지만 페이드 효과가 없음

**해결 방법**:
1. `SceneFadeManager` 컴포넌트가 씬에 있는지 확인
2. `FadePanel` Image가 설정되어 있는지 확인
3. `FadePanel`의 초기 Alpha 값이 0인지 확인

### 문제 3: 씬이 검은 화면으로 남음

**증상**: 씬 전환 후 검은 화면에 갇힘

**해결 방법**:
1. `SceneFadeManager`의 `FadeIn()`이 `Start()`에서 자동으로 호출되는지 확인
2. `FadePanel`의 Alpha 값이 1로 고정되어 있지 않은지 확인
3. 씬에 카메라가 있는지 확인

---

## 참고 자료

### 관련 스크립트

- `Assets/Scripts/Ryu/Global/Managers/EndingManager.cs` - 엔딩 관리 및 씬 이름 매핑
- `Assets/Scripts/Ryu/Global/Utils/SceneFadeManager.cs` - 씬 전환 및 페이드 효과
- `Assets/Scripts/Ryu/GameOver/GameOverManager.cs` - GameOver 씬 관리 (참고용)

### 관련 씬

- `Assets/Scenes/Ryu/GameOver.unity` - 기존 엔딩 씬 (참고용)
- `Assets/Scenes/Ryu/PlayersRoom.unity` - 일반 씬 구조 참고용

### 관련 문서

- `마크다운/변경사항/0211/황동_열쇠_획득_및_엔딩_트리거_테스트_계획서.md` - TC-04 테스트 계획
- `마크다운/변경사항/0211/방_씬_생성_시스템_구축_계획.md` - 씬 생성 시스템 계획

---

## 다음 단계

엔딩 씬을 생성한 후:

1. **TC-04 테스트 재실행**
   - 엔딩 트리거 수신 확인
   - 씬 전환 성공 확인

2. **엔딩 씬 UI 개선** (선택)
   - 엔딩별 고유한 배경 이미지 추가
   - 엔딩 텍스트 스타일링
   - 재시작 버튼 추가

3. **엔딩 씬별 특수 기능 추가** (선택)
   - 각 엔딩에 맞는 애니메이션
   - 사운드 효과
   - 크레딧 화면

---

**문서 끝**


